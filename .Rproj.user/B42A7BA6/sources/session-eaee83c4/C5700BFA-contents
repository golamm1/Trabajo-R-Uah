#Instalación de paquetes a utilizar
install.packages("pacman")
#Carga de paquetes
pacman::p_load(dplyr, sjmisc, car, sjlabelled, stargazer, haven)
#Ajuste del espacio de trabajo
rm(list=ls())       
options(scipen=999) 
#Abrimos base de datos
setwd("C:/Users/franr/OneDrive/Documentos/GitHub/Trabajo-R-Uah/Processing")
casen2022 <- read_dta("CASEN.dta")

#Chequeo de base de datos
dim(casen2022)
View(casen2022)

#Paso 1: Selección de variables
#1.1: Buscamos variables con la palabra creditos
find_var(data = casen2022,"educación")
#1.2: Selección de variables a utilizar para el estudio
indicadores <- casen2022 %>% select(asistencia, 
                                      rezago, 
                                      escolaridad, 
                                      malnutricion, 
                                      sist_salud, 
                                      atencion, 
                                      ocupacion, 
                                      seg_social, 
                                      jubilacion, 
                                      hacinamiento, 
                                      estado_vivienda=vivienda, 
                                      serv_basicos)  %>%
  na.omit() %>% # Eliminar Na's
  mutate_all(~(as.numeric(.)))
#Variables para cada dimensión
indicadores = indicadores %>% 
  rowwise() %>%
  mutate(educ = mean(c(asistencia, rezago, escolaridad)),
         salud = mean(c(malnutricion, sist_salud, atencion)),
         trabajo= mean(c(ocupacion, seg_social, jubilacion)),
         vivienda= mean(c(hacinamiento, estado_vivienda, serv_basicos))) %>% 
  ungroup()
#Obtenemos el promedio de las cuatro dimensiones para constatar el índice de pobreza multidimensional
indicadores = indicadores %>% 
  rowwise() %>%
  mutate(pobreza = mean(c(educ, salud, trabajo, vivienda))) %>% 
  ungroup()
#vemos los 10 primeros casos
indicadores %>% select(pobreza) %>% head(10)
#Obtenemos datos descriptivos de la pobreza multidimensional
summary(indicadores$pobreza) # Resumen
indicadores <- indicadores %>% mutate(pobreza = case_when(pobreza>=0.25~"si",
                                                                  pobreza<0.25~"no")
)
prop.table(table(indicadores$pobreza))*100
